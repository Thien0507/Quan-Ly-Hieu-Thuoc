<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- list form -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <!-- 


      
     -->


     <!-- Giao dien chia 3 -->
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <style>
    /* Set height of the grid so .sidenav can be 100% (adjust if needed) */
    .row.content {height: 1500px}
    
    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }
    
    /* Set black background color, white text and some padding */
    footer {
      background-color: #555;
      color: white;
      padding: 15px;
    }
    
    /* On small screens, set height to 'auto' for sidenav and grid */
    @media screen and (max-width: 767px) {
      .sidenav {
        height: auto;
        padding: 4px;
      }
      .row.content {height: auto;} 
    }
  </style>
      <!--  -->

      <!-- search -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js" integrity="sha256-+C0A5Ilqmu4QcSPxrlGpaZxJ04VjsRjKu+G82kl5UJk=" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css" integrity="sha256-ze/OEYGcFbPRmvCnrSeKbRTtjG4vGLHXgOqsyLFTRjg=" crossorigin="anonymous" />
      
      <!--  -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/css/homepage.css" />
    <link rel="stylesheet" href="/css/sellpage.css" />
    <style></style>
    <title>Bán Thuốc</title>
  </head>
  <body style="background-color: #f1f1f1;">
    <div class="topnav" id="myTopnav">
      <a href="http://localhost:3000/homepage"">Trang Chủ</a>
      <a href="http://localhost:3000/managepage">Quản Lý Thuốc</a>
      <a href="http://localhost:3000/sellpage" class="active">Bán Thuốc</a>
      <a href="http://localhost:3000/importpage">Nhập Kho Thuốc</a>
      <a href="http://localhost:3000/clientspage">Khách Hàng </a>
      <a href="http://localhost:3000/userspage">Tài Khoản</a>
      <a href="http://localhost:3000/distributorspage">Nhà Phân Phối</a>
      <a href="http://localhost:3000/statisticalpage">Thống Kê</a>
      <div class="dropdown" style="float: right">
        <button class="dropbtn">
          <%=currentUser%>
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a href="javascript:void(0);">Log out</a>
        </div>
      </div>

      <a href="javascript:void(0);" class="icon" onclick="myFunction()">
        <i class="fa fa-bars"></i>
      </a>
    </div>

    <div class="container-fluid" style="margin-top: 40px">
      <div class="row ">
        <div class="col-sm-5 sidenav">
          <div class="container-xl">
          </div>
          <div class="table-responsive">
            <div class="table-wrapper">
              <div class="table-title">
                <div class="row">
                  <div class="col-sm-5">
                    <h2><b>Chi tiết hóa đơn</b></h2>
                  </div>
                  <div class="col-sm-7">
                    <a href="#exportEmployeeModal-CTHD" class="btn btn-danger btn-export" data-toggle="modal"><i class="material-icons">&#xe9a1;</i> <span>Xuất hóa đơn</span></a>						
                    <a href="#addEmployeeModal-CTHD" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Thêm sản phẩm </span></a>
                  </div>
                </div>
              </div>  
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th style="display: none;">
                      <span class="custom-checkbox">
                        <input type="checkbox" id="selectAll">
                        <label for="selectAll"></label>
                      </span>
                    </th>
                    <th>Tên thuốc</th>
                    <th>Số lượng</th>
                    <th>Giá bán</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                    <% for (let i = 0; i < CTHDX_SESSIONS.length; i++) { %>
                    <tr class="row-client">
                      <td style="display: none;">
                        <span class="custom-checkbox">
                          <input type="checkbox" class="checkbox" id=<%="checkboxCTHDX" + Drugs.find((drug, index) => drug.TenThuoc === CTHDX_SESSIONS[i].TenThuoc).IDThuoc %> name="options[]" value="1">
                          <label for="checkbox1"></label>
                        </span>
                      </td>
                      <td><%=CTHDX_SESSIONS[i].TenThuoc%></td>
                      <td><%=CTHDX_SESSIONS[i].SoLuong%></td>
                      <td><%=Drugs.find((drug, index) => drug.TenThuoc === CTHDX_SESSIONS[i].TenThuoc).GiaBan%></td>
                      <td>
                        <a href="#editEmployeeModal-CTHD" class="edit-CTHD" id=<%="edit" + i %> data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
                        <a href="#deleteEmployeeModal-CTHD" class="delete-CTHD" id=<%="delete" + i %> data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>
                      </td>
                    </tr>
                    <% } %>
                </tbody>
              </table>
            </div>
          </div>        
          <!-- Edit Modal HTML -->
          <div id="addEmployeeModal-CTHD" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Thêm sản phẩm vào giỏ</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <div class="form-group">
                      <label>Tên Thuốc</label>
                      <select id="select-state" class="form-control" placeholder="Chọn tên thuốc">
                        <% for (let i = 0; i < Drugs.length; i++) { %>
                          <option value="<%= Drugs[i].TenThuoc %>"><%=`${Drugs[i].TenThuoc} - Số lượng: ${Drugs[i].SoLuong}`%></option>
                        <% } %>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Số lượng</label>
                      <input type="text" class="form-control" required>
                    </div>									
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-success" value="Add">
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- Edit Modal HTML -->
          <div id="editEmployeeModal-CTHD" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Chỉnh sửa sản phẩm đã chọn</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <div class="form-group">
                      <label>Tên Thuốc</label>
                      <select id="select-state" class=  "form-control" placeholder="Chọn tên thuốc">
                        <% for (let i = 0; i < Drugs.length; i++) { %>
                          <option value="<%=Drugs[i].TenThuoc%>"><%=`${Drugs[i].TenThuoc} - SL: ${Drugs[i].SoLuong}`%></option>
                        <% } %>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Số lượng</label>
                      <input type="text" class="form-control" required>
                    </div>						
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-info" value="Save">
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- Delete Modal HTML -->
          <div id="deleteEmployeeModal-CTHD" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Xóa sản phẩm vừa chọn</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <p>Bạn có chắc chắn muốn xóa mục đã chọn</p>
                    <p class="text-warning"><small>Hành động này không thể hoàn tác.</small></p>
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Hủy bỏ">
                    <input type="submit" class="btn btn-danger" value="Xóa">
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- export Modal HTML -->
          <div id="exportEmployeeModal-CTHD" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Xuất hóa đơn</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <div class="form-group">
                      <label>Khách hàng</label>
                      <select id="select-state" class="form-control" placeholder="Chọn nhà phân phối">
                        <% for(let i = 0; i < Clients.length; i++) { %> 
                        <option value="<%=Clients[i].IDKhachHang%>"><%=Clients[i].TenKhachHang + ' - ' + Clients[i].DienThoai %></option>
                        <% } %>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Tổng tiền thuốc</label>
                      <input type="text" class="form-control " readonly required>
                    </div>	
                    <div class="form-group">
                      <label>Tổng thuế</label>
                      <input type="text" class="form-control" required>
                    </div>	
                    <div class="form-group">
                      <label>Ngày nhập</label>
                      <input type="date" class="form-control" required></input>
                    </div>				
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-success" value="Add">
                  </div>
                </form>
              </div>
            </div>
          </div>
    
        </div>
        
        <!-- 

         -->
         <div class="col-sm-7 sidenav hdx-page">
          <div class="container-xl">
          </div>
          <div class="table-responsive">
            <div class="table-wrapper">
              <div class="table-title">
                <div class="row">
                  <div class="col-sm-6">
                    <h2><b>Hóa đơn xuất</b></h2>
                  </div>
                  <!-- <div class="col-sm-6">
                    <a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Thêm hóa đơn</span></a>
                    <a href="#deleteEmployeeModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Xóa hóa đơn</span></a>						
                  </div> -->
                </div>
              </div>
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th style="display: none;">
                      <span class="custom-checkbox">
                        <input type="checkbox" id="selectAll">
                        <label for="selectAll"></label>
                      </span>
                    </th>
                    <th>Khách hàng</th>
                    <th>Tổng tiền thuốc</th>
                    <th>Tổng thuế</th>
                    <th>Tổng tiền hóa đơn</th>
                    <th>Ngày xuất</th>
                    <th>Người xuất</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% for (let i = HDX.length - 1; i >= 0; i--) { %>
                    <tr class="row-client <%= "item" + Number(HDX.length - 1 - i) %>">
                      <td style="display: none;"  >
                        <span class="custom-checkbox">
                          <input type="checkbox" id="checkbox1" name="options[]" value="1">
                          <label for="checkbox1"></label>
                        </span>
                      </td>
                      <td><%= HDX[i].TenKhachHang %></td>
                      <td><%= HDX[i].TongTienThuoc %></td>
                      <td><%= HDX[i].TongThue %></td>
                      <td><%= HDX[i].TongTienHDX %></td>
                      <td><%= HDX[i].NgayXuat.slice(0,10) %></td>
                      <td><%= HDX[i].HoTen %></td>
                      <td style="width: 15%">
                        <a href="#editEmployeeModal" class="edit" id=<%="editHDX" + HDX[i].IDHoaDonXuat %> data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
                        <a href="#deleteEmployeeModal" class="delete" id=<%="deleteHDX" + HDX[i].IDHoaDonXuat %> data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>
                        <a href="#exportEmployeeModal" class="export" id=<%="exportHDX" + HDX[i].IDHoaDonXuat %>" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Export">&#xe149;</i></a>
                      </td>
                    </tr>
                    <% } %>
                    
                </tbody>
              </table>


              <div class="clearfix">
                <div class="hint-text">Hiển thị <b>10</b> trên <b><%=HDX.length%></b> hóa đơn xuất</div>
                <ul class="pagination">
                  <li class="page-item disabled"><a href="#">Previous</a></li>
                  <% for (let j = 0; j < Math.ceil(HDX.length / 10); j ++) {%>
                    <%  if (j == 0){%>
                      <li class="page-item active"><a href="#" class="page-link"><%=j+1%></a></li>
                    <% } else { %>
                      <li class="page-item"><a href="#" class="page-link"><%=j+1%></a></li>
                    <% } %>
                  <% } %>
                  <!-- <li class="page-item"><a href="#" class="page-link">1</a></li>
                  <li class="page-item"><a href="#" class="page-link">2</a></li>
                  <li class="page-item active"><a href="#" class="page-link">3</a></li>
                  <li class="page-item"><a href="#" class="page-link">4</a></li>
                  <li class="page-item"><a href="#" class="page-link">5</a></li> -->
                  <li class="page-item"><a href="#" class="page-link">Next</a></li>
                </ul>
              </div>


            </div>
          </div>          
          <!-- Edit Modal HTML -->
          <div id="addEmployeeModal" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Thêm hóa đơn</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <div class="form-group">
                      <label>Khách hàng</label>
                      <select id="select-state" class="form-control" placeholder="Chọn nhà phân phối">
                        <% for(let i = 0; i < Clients.length; i++) { %> 
                        <option value="<%=Clients[i].IDKhachHang%>"><%=Clients[i].TenKhachHang%></option>
                        <% } %>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Tổng tiền thuốc</label>
                      <input type="text" class="form-control" required>
                    </div>	
                    <div class="form-group">
                      <label>Tổng thuế</label>
                      <input type="text" class="form-control" required>
                    </div>
                    <div class="form-group">
                      <label>Tổng hóa đơn xuất</label>
                      <input type="text" class="form-control" required>
                    </div>	
                    <div class="form-group">
                      <label>Ngày nhập</label>
                      <input type="date" class="form-control" required></input>
                    </div>				
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-success" value="Add">
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- Edit Modal HTML -->
          <div id="editEmployeeModal" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Chỉnh sửa sản phẩm đã chọn</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <div class="form-group">
                      <label>Khách hàng</label>
                      <select id="select-state" class="form-control" placeholder="Chọn khách hàng">
                        <% for(let i = 0; i < Clients.length; i++) { %> 
                          <option value="<%=Clients[i].IDKhachHang%>"><%=Clients[i].TenKhachHang + ' - ' + Clients[i].DienThoai %></option>
                        <% } %>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Tổng tiền thuốc</label>
                      <input type="text" class="form-control" readonly required>
                    </div>						
                    <div class="form-group">
                      <label>Tổng thuế</label>
                      <input type="text" class="form-control" required>
                    </div>
                    <div class="form-group">
                      <label>Ngày xuất</label>
                      <input type="date" class="form-control" required>
                    </div>	
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-info" value="Save">
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- Delete Modal HTML -->
          <div id="deleteEmployeeModal" class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content">
                <form>
                  <div class="modal-header">						
                    <h4 class="modal-title">Xóa hóa đơn</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">					
                    <p>Bạn có chắc chắn muốn xóa mục đã chọn</p>
                    <p class="text-warning"><small>Hành động này không thể hoàn tác.</small></p>
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Hủy bỏ">
                    <input type="submit" class="btn btn-danger" value="Xóa">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>


      </div>
    </div>

    <script>
      const hdxPage = document.getElementsByClassName("hdx-page")[0];
      const tables = hdxPage.getElementsByTagName("tbody")[0];
      const items = tables.getElementsByClassName("row-client")

      const pagination = document.getElementsByClassName("pagination")[0];
      const pages = pagination.getElementsByClassName("page-item");
      let activePage = pagination.getElementsByClassName("active")[0];

      let beforeTab = 1;
      let afterTab = 2;
      
      let currentTab = 1;
      const setCurrentState = (currentTab) => {
        for (let i = 0; i < items.length; i++) {
          if (i >= (currentTab - 1) * 10 && i < currentTab * 10) {
            items[i].style.display = "";
        } else {
          items[i].style.display = "none"
        }
        if (currentTab >= 2) {
        pages[0].classList.contains("disabled")
          ? pages[0].classList.toggle("disabled")
          : pages[0].classList;
        console.log(pages[0].classList);
        }
      afterTab = 2;
      beforeTab = 1;
      if (currentTab == 1) {
        pages[0].classList.contains("disabled")
          ? pages[0].classList
          : pages[0].classList.toggle("disabled");
        afterTab = 3;
        beforeTab = 0;
      }
      if (currentTab  == pages.length - 3) {
        afterTab = 1;
        beforeTab = 2;
      }
      if (currentTab  == pages.length - 2) {
        afterTab = 1;
        beforeTab = 3;
      }
      for (let i = 1; i < pages.length - 1; i++) {
        if (i >= currentTab  * 1 - beforeTab && i <= currentTab  * 1 + afterTab) {
          pages[i].style.display = "";
        } else if (i <= pages.length - 2) {
          pages[i].style.display = "none";
        }
      }
      }
    }
    setCurrentState(currentTab);
  for (let index in pages) {
    if (index == 0) {
      pages[index].addEventListener("click", () => {
        if (currentTab  >=2) {
          console.log(currentTab)
          activePage.classList.toggle("active");
          pages[currentTab - 1].classList.toggle("active");
          activePage = pages[currentTab - 1];
          currentTab--;
          setCurrentState(currentTab);
        }
      });
    }
    if (index == pages.length * 1 - 1) {
      pages[index].addEventListener("click", () => {
        if (currentTab  < pages.length * 1 - 2) {
          activePage.classList.toggle("active");
          pages[currentTab + 1].classList.toggle("active");
          activePage = pages[currentTab + 1];
          currentTab++;
          console.log(activePage.textContent);
          setCurrentState(currentTab);
        }
      });
    }
    if (index != 0 && index <= pages.length * 1 - 2) {
      pages[index].addEventListener("click", () => {
        activePage.classList.toggle("active");
        pages[index].classList.toggle("active");
        activePage = pages[index];
        currentTab = index;
        setCurrentState(currentTab);
      });
    }
}
    </script>
    <script src="/js/sellpage.js"></script>
  </body>
</html>
